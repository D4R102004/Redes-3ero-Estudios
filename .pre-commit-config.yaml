# =============================================================================
# PRE-COMMIT HOOKS - Guardianes Autom√°ticos de Calidad
# =============================================================================
# Este archivo configura revisiones autom√°ticas que se ejecutan ANTES de cada commit.
# Es como tener un revisor autom√°tico que revisa tu c√≥digo instant√°neamente.
#
# ¬øQu√© es un "hook"? Una verificaci√≥n espec√≠fica (formato, errores, seguridad, etc.)
#
# Instalaci√≥n:
#   pip install pre-commit
#   pre-commit install
#
# Uso:
#   git commit ‚Üí Los hooks se ejecutan autom√°ticamente
#   pre-commit run --all-files ‚Üí Ejecutar manualmente en todos los archivos

# ============================================
# CONFIGURACI√ìN GENERAL
# ============================================

# Fallar r√°pido: si un hook falla, no ejecutar los siguientes
fail_fast: false

# Repositorios de hooks (cada uno tiene diferentes revisores)
repos:
  # ============================================
  # HOOKS B√ÅSICOS DE PRE-COMMIT
  # ============================================
  # Estos son revisores generales que funcionan para cualquier tipo de archivo

  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.5.0
    hooks:
      # Elimina espacios en blanco al final de las l√≠neas
      # ¬øPor qu√©? Mejora legibilidad y evita cambios innecesarios en Git
      - id: trailing-whitespace
        name: "üßπ Limpiar espacios en blanco finales"

      # Asegura que los archivos terminen con una l√≠nea vac√≠a
      # ¬øPor qu√©? Est√°ndar de POSIX, evita problemas en algunos editores
      - id: end-of-file-fixer
        name: "üìù Agregar l√≠nea final a archivos"

      # Verifica que los archivos YAML sean v√°lidos
      - id: check-yaml
        name: "‚úÖ Validar archivos YAML"
        exclude: ^mkdocs\.yml$  # Excluir mkdocs.yml si usa sintaxis especial

      # Verifica que los archivos JSON sean v√°lidos
      - id: check-json
        name: "‚úÖ Validar archivos JSON"

      # Detecta archivos grandes que no deber√≠an estar en Git
      # (>500KB por defecto)
      - id: check-added-large-files
        name: "üö® Detectar archivos grandes"
        args: ['--maxkb=1000']  # L√≠mite: 1MB

      # Detecta merge conflict markers que quedaron sin resolver
      - id: check-merge-conflict
        name: "‚ö†Ô∏è  Detectar conflictos de merge sin resolver"

  # ============================================
  # RUFF - Linter y Formateador Moderno
  # ============================================
  # Ruff reemplaza a: flake8, isort, black, pylint, etc.
  # Es MUCHO m√°s r√°pido (escrito en Rust)

  - repo: https://github.com/astral-sh/ruff-pre-commit
    rev: v0.1.9
    hooks:
      # Ruff como linter (detecta errores)
      - id: ruff
        name: "üîç Ruff: An√°lisis de c√≥digo"
        args:
          - --fix              # Intentar arreglar autom√°ticamente
          - --exit-non-zero-on-fix  # Fallar si hizo cambios (para que veas qu√© cambi√≥)
        types: [python]

      # Ruff como formateador (reemplaza a Black)
      - id: ruff-format
        name: "üé® Ruff: Formateo de c√≥digo"
        types: [python]

# ============================================
  # MYPY - Type Checking Est√°tico
  # ============================================
  # Mypy verifica que los tipos de datos sean correctos

  - repo: https://github.com/pre-commit/mirrors-mypy
    rev: v1.7.1
    hooks:
      - id: mypy
        name: "üî¨ Mypy: Verificaci√≥n de tipos"
        additional_dependencies:
          - types-requests
          - types-setuptools
        args:
          - --ignore-missing-imports
          - --no-strict-optional
        exclude: ^tests/
  # ============================================
  # BANDIT - Detector de Vulnerabilidades
  # ============================================
  # Busca problemas de seguridad en el c√≥digo Python

  - repo: https://github.com/PyCQA/bandit
    rev: 1.7.6
    hooks:
      - id: bandit
        name: "üõ°Ô∏è  Bandit: An√°lisis de seguridad"
        args:
          - -ll  # Solo reportar problemas de severidad media-alta
          - --skip=B101  # Ignorar asserts (OK en c√≥digo educativo)
        exclude: ^tests/  # Los tests pueden tener c√≥digo "inseguro" a prop√≥sito

# ============================================
# NOTAS IMPORTANTES
# ============================================
#
# 1. Instalaci√≥n inicial:
#    $ pre-commit install
#
# 2. Ejecutar manualmente en todos los archivos:
#    $ pre-commit run --all-files
#
# 3. Actualizar hooks a versiones m√°s recientes:
#    $ pre-commit autoupdate
#
# 4. Si un hook falla y est√°s seguro de que est√° bien:
#    $ git commit --no-verify
#    (Pero √∫salo con cuidado - los hooks existen por algo)
#
# 5. Los hooks solo se ejecutan en archivos que est√°n en "staging"
#    (es decir, archivos que agregaste con 'git add')
